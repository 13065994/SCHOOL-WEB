<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Gallery</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      padding: 20px;
    }

    .form-label {
      font-weight: bold;
    }

    #gallery-preview .gallery-item {
      margin-bottom: 20px;
      text-align: center;
    }

    #gallery-preview img {
      max-width: 100%;
      height: auto;
      border: 2px solid #28a745;
      border-radius: 5px;
    }

    .delete-button {
      margin-top: 10px;
      color: white;
      background-color: #dc3545;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .delete-button:hover {
      background-color: #c82333;
    }

    #message {
      margin-top: 10px;
      font-weight: bold;
    }

    /* Custom Styles for Tab Navigation */
    .nav-tabs .nav-link {
      color: #28a745;
    }

    .nav-tabs .nav-link.active {
      background-color: #28a745;
      color: white;
    }

    .back-to-site {
      text-align: center;
      margin-top: 20px;
    }

    .back-to-site a {
      color: #28a745;
      font-weight: bold;
      text-decoration: none;
    }

    .back-to-site a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
<!-- Tab navigation for Gallery and Newsletter Editors -->
<ul class="nav nav-tabs" id="editorTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="gallery-tab" data-bs-toggle="tab" data-bs-target="#gallery-editor" type="button" role="tab" aria-controls="gallery-editor" aria-selected="true">Gallery Editor</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="newsletter-tab" data-bs-toggle="tab" data-bs-target="#newsletter-editor" type="button" role="tab" aria-controls="newsletter-editor" aria-selected="false">Newsletter Editor</button>
  </li>
</ul>

<!-- Tab content -->
<div class="tab-content" id="editorTabContent">
  <!-- Gallery Editor -->
  <div class="tab-pane fade show active" id="gallery-editor" role="tabpanel" aria-labelledby="gallery-tab">
    <div class="container mt-4">
      <h2 class="text-success">Manage Gallery</h2>
      <form id="gallery-form" class="mb-4">
        <div class="mb-3">
          <label for="gallery-upload" class="form-label">Upload Image:</label>
          <input type="file" id="gallery-upload" class="form-control" accept="image/*">
        </div>
        <div class="mb-3">
          <label for="image-url" class="form-label">Or Enter Image URL:</label>
          <input type="url" id="image-url" class="form-control" placeholder="Image URL">
        </div>
        <button type="submit" id="upload-button" class="btn btn-success">Add to Gallery</button>
      </form>

      <!-- Success/Error Message -->
      <div id="message" class="text-center"></div>

      <!-- Gallery Preview for Admin -->
      <h3 class="text-success">Current Gallery</h3>
      <div id="gallery-preview" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4"></div>
    </div>
  </div>

  <!-- Newsletter Editor -->
  <div class="tab-pane fade" id="newsletter-editor" role="tabpanel" aria-labelledby="newsletter-tab">
    <div class="container mt-4">
      <h2 class="text-success">Edit Newsletter</h2>
      <!-- Newsletter editor content can go here -->
      <form id="newsletter-form" class="mb-4">
        <div class="mb-3">
          <label for="news-title" class="form-label">News Title:</label>
          <input type="text" id="news-title" class="form-control" placeholder="Enter News Title" required>
        </div>
        
        <div class="mb-3">
          <label for="news-content" class="form-label">Content:</label>
          <textarea id="news-content" class="form-control" rows="4" placeholder="Enter News Content" required></textarea>
        </div>
          <!-- Add bullet points (optional) -->
      <div class="mb-3">
        <label for="bullet-points" class="form-label">Key Highlights:</label>
        <div id="bullet-points-container">
          <div class="input-group mb-2">
            <input type="text" class="form-control bullet-point" placeholder="Highlight 1">
            <button type="button" class="btn btn-danger remove-bullet-point">Remove</button>
          </div>
        </div>
        <button type="button" id="add-bullet-point" class="btn btn-success mt-2">Add Highlight</button>
      </div> 
    
        <div class="mb-3">
          <label for="news-image" class="form-label">Upload Image (for image-based news):</label>
          <input type="file" id="news-image" class="form-control" accept="image/*">
        </div>
    
        <div class="mb-3">
          <label for="news-video" class="form-label">Upload Video:</label>
          <input type="file" id="news-video" class="form-control" accept="video/*">
        </div>
        
        <div class="mb-3" id="thumbnail-section" style="display: none;">
          <label for="news-thumbnail" class="form-label">Video Thumbnail (optional for video):</label>
          <input type="file" id="news-thumbnail" class="form-control" accept="image/*">
        </div>
    
        <button type="submit" class="btn btn-success">Add to Newsletter</button>
      </form>
       <!-- Newsletter Preview for Admin -->
  <h3 class="text-success">Current News Items</h3>
  <div id="news-preview" class="swiper-wrapper"></div>
    </div>
  </div>
</div>

<div class="back-to-site">
  <a href="/">‚Üê Back to the Website</a>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>


<script type="module">
  // Import Firebase SDK modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-storage.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

  // Firebase configuration
  const firebaseConfig = {
      apiKey: "AIzaSyDKHZ1viqinUqJcs4He9QGnq2Ld82jSt-M",
      authDomain: "juli-tola.firebaseapp.com",
      projectId: "juli-tola",
      storageBucket: "juli-tola.appspot.com",
      messagingSenderId: "452807393853",
      appId: "1:452807393853:web:2c58c3ca257ea605f6e054",
      measurementId: "G-FVNPXHKQLJ"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);
  const db = getFirestore(app);
  const galleryRef = collection(db, 'gallery');
  const newsletterRef = collection(db, 'newsletters');

  // Tab functionality
  const galleryTab = document.getElementById('gallery-tab');
  const newsletterTab = document.getElementById('newsletter-tab');
  const galleryContent = document.getElementById('gallery-content');
  const newsletterContent = document.getElementById('newsletter-content');

  galleryTab.addEventListener('click', () => {
      galleryTab.classList.add('active');
      newsletterTab.classList.remove('active');
      galleryContent.classList.add('active');
      newsletterContent.classList.remove('active');
  });

  newsletterTab.addEventListener('click', () => {
      newsletterTab.classList.add('active');
      galleryTab.classList.remove('active');
      newsletterContent.classList.add('active');
      galleryContent.classList.remove('active');
  });

  // Function to display messages
  function displayMessage(message, isError = false) {
      const messageDiv = document.getElementById('message');
      messageDiv.textContent = message;
      messageDiv.style.color = isError ? 'red' : 'green';
      setTimeout(() => messageDiv.textContent = '', 3000);
  }

  // Function to load gallery images from Firestore
  async function loadGallery() {
      const galleryContainer = document.getElementById('gallery-preview');
      galleryContainer.innerHTML = ''; // Clear the gallery container
      try {
          const querySnapshot = await getDocs(galleryRef);
          querySnapshot.forEach((doc) => {
              const imageData = doc.data();
              const imageElement = document.createElement('div');
              imageElement.classList.add('gallery-item');
              imageElement.innerHTML = `
                  <img src="${imageData.url}" alt="Gallery Image">
                  <button data-id="${doc.id}" class="delete-button">Delete</button>
              `;
              galleryContainer.appendChild(imageElement);
          });

          // Add delete functionality to delete buttons
          const deleteButtons = document.querySelectorAll('.delete-button');
          deleteButtons.forEach(button => {
              button.addEventListener('click', async (event) => {
                  const docId = event.target.getAttribute('data-id');
                  await deleteDoc(doc(db, 'gallery', docId));
                  displayMessage('Image deleted successfully!');
                  loadGallery(); // Reload gallery after deletion
              });
          });
      } catch (error) {
          console.error('Error loading gallery:', error);
          displayMessage('Error loading gallery', true);
      }
  }

  // Load gallery on page load
  window.onload = loadGallery;

  // Handle form submission for adding images
  document.getElementById('gallery-form').addEventListener('submit', async (event) => {
      event.preventDefault();
      const fileInput = document.getElementById('gallery-upload');
      const imageUrlInput = document.getElementById('image-url');
      const file = fileInput.files[0];
      const imageUrl = imageUrlInput.value.trim();

      if (file) {
          // Upload file to Firebase Storage
          const storageRef = ref(storage, 'gallery/' + file.name);
          try {
              const snapshot = await uploadBytes(storageRef, file);
              const url = await getDownloadURL(snapshot.ref);
              await addDoc(galleryRef, { url });
              displayMessage('Image uploaded successfully!');
              loadGallery(); // Refresh gallery after successful upload
              fileInput.value = '';
              imageUrlInput.value = '';
          } catch (error) {
              console.error('Error uploading file:', error);
              displayMessage('Error uploading image.', true);
          }
      } else if (imageUrl) {
          // Add URL to Firestore if no file uploaded
          try {
              await addDoc(galleryRef, { url: imageUrl });
              displayMessage('Image URL added successfully!');
              loadGallery(); // Refresh gallery after adding URL
              fileInput.value = '';
              imageUrlInput.value = '';
          } catch (error) {
              console.error('Error adding image URL:', error);
              displayMessage('Error adding image URL.', true);
          }
      } else {
          displayMessage('Please select a file or enter an image URL.', true);
      }
  });

  // Handle form submission for adding newsletters
  document.getElementById('newsletter-form').addEventListener('submit', async (event) => {
      event.preventDefault();
      const newsTitle = document.getElementById('news-title').value.trim();
      const newsContent = document.getElementById('news-content').value.trim();
      const bulletPoints = Array.from(document.getElementsByClassName('bullet-point')).map(bp => bp.value.trim());
      const newsImageFile = document.getElementById('news-image').files[0];
      const newsVideoFile = document.getElementById('news-video').files[0];
      const thumbnailFile = document.getElementById('news-thumbnail').files[0];

      try {
          let imageUrl = '', videoUrl = '', thumbnailUrl = '';

          // Upload files to Firebase Storage and get URLs
          if (newsImageFile) {
              const imageStorageRef = ref(storage, 'newsletters/' + newsImageFile.name);
              const imageSnapshot = await uploadBytes(imageStorageRef, newsImageFile);
              imageUrl = await getDownloadURL(imageSnapshot.ref);
          }

          if (newsVideoFile) {
              const videoStorageRef = ref(storage, 'newsletters/videos/' + newsVideoFile.name);
              const videoSnapshot = await uploadBytes(videoStorageRef, newsVideoFile);
              videoUrl = await getDownloadURL(videoSnapshot.ref);
          }

          if (thumbnailFile) {
              const thumbnailStorageRef = ref(storage, 'newsletters/thumbnails/' + thumbnailFile.name);
              const thumbnailSnapshot = await uploadBytes(thumbnailStorageRef, thumbnailFile);
              thumbnailUrl = await getDownloadURL(thumbnailSnapshot.ref);
          }

          // Add newsletter details to Firestore
          await addDoc(newsletterRef, {
              title: newsTitle,
              content: newsContent,
              bulletPoints: bulletPoints,
              imageUrl: imageUrl,
              videoUrl: videoUrl,
              thumbnailUrl: thumbnailUrl,
              createdAt: new Date(),
          });

          displayMessage('Newsletter added successfully!');
          document.getElementById('newsletter-form').reset();
      } catch (error) {
          console.error('Error adding newsletter:', error);
          displayMessage('Error adding newsletter.', true);
      }
  });
</script>

</body>
</html>
