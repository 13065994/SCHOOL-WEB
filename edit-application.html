<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel - Student Applications</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.css"
      rel="stylesheet"
    />
    <style>
      .application-card {
        transition: all 0.3s ease;
      }
      .application-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .badge-status {
        font-size: 0.9em;
        padding: 8px 12px;
      }
      .actions-bar {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
      }

      /* Mobile-specific style for search button */
      @media (max-width: 576px) {
        .search-btn {
          width: 100%; /* Ensure the search button takes full width on mobile */
          font-size: 0.9rem; /* Make the button smaller on mobile */
        }
      }
    </style>
  </head>
  <body class="bg-light">
    <!-- Main Content -->
    <div class="container">
      <!-- Removed the stats row -->

      <!-- Applications List -->
      <div class="card shadow-sm mt-5">
        <div class="card-body">
          <div id="applicationsList" class="row g-4">
            <!-- Applications will be loaded here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Application Details Modal -->
    <div class="modal fade" id="applicationModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Application Details</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body" id="applicationDetails">
            <!-- Application details will be loaded here -->
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        deleteDoc,
        doc,
      } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDKHZ1viqinUqJcs4He9QGnq2Ld82jSt-M",
        authDomain: "juli-tola.firebaseapp.com",
        projectId: "juli-tola",
        storageBucket: "juli-tola.appspot.com",
        messagingSenderId: "452807393853",
        appId: "1:452807393853:web:2c58c3ca257ea605f6e054",
        measurementId: "G-FVNPXHKQLJ",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      let applications = [];

      async function loadApplications() {
        try {
          const querySnapshot = await getDocs(collection(db, "applications"));
          applications = [];
          querySnapshot.forEach((doc) => {
            applications.push({ id: doc.id, ...doc.data() });
          });
          renderApplications();
        } catch (error) {
          console.error("Error loading applications:", error);
          Swal.fire({
            title: "Error!",
            text: "Failed to load applications",
            icon: "error",
          });
        }
      }

      function renderApplications() {
        const container = document.getElementById("applicationsList");
        container.innerHTML = "";

        applications.forEach((app) => {
          const card = document.createElement("div");
          card.className = "col-md-6 col-lg-4";
          card.innerHTML = `
                    <div class="card application-card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h5 class="card-title">${
                                  app.applicantName || "No Name"
                                }</h5>
                              
                            </div>
                            <p class="card-text">
                                <strong>Class:</strong> ${
                                  app.admissionClass || "Not specified"
                                }<br>
                                <strong>Submitted:</strong> ${formatDate(
                                  app.submittedAt
                                )}
                            </p>
                            <div class="d-flex justify-content-between mt-3">
                                <button class="btn btn-primary btn-sm" onclick="viewApplication('${
                                  app.id
                                }')">
                                    <i class="fas fa-eye me-2"></i>View
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="deleteApplication('${
                                  app.id
                                }')">
                                    <i class="fas fa-trash me-2"></i>Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
          container.appendChild(card);
        });
      }

      function formatDate(timestamp) {
        if (!timestamp) return "Unknown";
        const date = new Date(timestamp.seconds * 1000);
        return date.toLocaleDateString();
      }

      function getStatusColor(status) {
        switch (status) {
          case "Approved":
            return "success";
          case "Rejected":
            return "danger";
          default:
            return "warning";
        }
      }

      window.viewApplication = (id) => {
        const app = applications.find((a) => a.id === id);
        if (!app) return;

        const modalBody = document.getElementById("applicationDetails");
        modalBody.innerHTML = `
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-4">
                            <img src="${
                              app.passportUrl ||
                              "https://via.placeholder.com/150"
                            }" 
                                 alt="Passport" 
                                 class="img-fluid rounded mb-3">
                        </div>
                        <div class="col-md-8">
                            <h4>${app.applicantName}</h4>
                            <p class="text-muted">Application ID: ${app.id}</p>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-8">
 <h2><strong>Personal Details</strong></h2> 
            <p><strong>Name:</strong> ${app.applicantName || ""}</p>
            <p><strong>Date of Birth:</strong> ${app.dob || ""}</p>
            <p><strong>Gender:</strong> ${app.gender || ""}</p>
            <p><strong>Religion:</strong> ${app.religion || ""}</p>
            <p><strong>Nationality:</strong> ${app.nationality || ""}</p>
          </div>
           <div class="col-md-6">
            <p><strong>State:</strong> ${app.state || ""}</p>
            <p><strong>LGA:</strong> ${app.lga || ""}</p>
            <p><strong>Home Town:</strong> ${app.homeTown || ""}</p>
            <p><strong>Present Class:</strong> ${app.presentClass || ""}</p>
            <p><strong>Name of Last School Attended:</strong> ${
              app.lastSchool || ""
            }</p>
            <p><strong>Class To Which Admission Is Being Sought:</strong> ${
              app.admissionClass || ""
            }</p>

                    </div>

                </div>

                 <div class="row">
                    <hr/>
                        <div class="col-md-8">
 <h2><strong>Medical Information</strong></h2> 
           <div class="section mb-4">
        <h5>Medical Information</h5>
        <p><strong>Allergies:</strong> ${app.allergies || "none"}</p>
        <p><strong>Allergy List:</strong> ${app.allergyList || "none"}</p>
        <p><strong>Medications:</strong> ${app.medications || "none"}</p>
        <p><strong>Immunization Status:</strong> ${
          app.immunization || "none"
        }</p>
        <p><strong>Special Needs:</strong> ${app.specialNeeds || "none"}</p>
      </div>
                    </div>

                </div>

                 <div class="row">
                    <hr/>
                        <div class="col-md-8">
 
 
 <h2><strong>Parents Information</strong></h2> 
        <div class="father-info mb-3">
          <h6 class="mt-2"><strong>Father's Details</strong></h6>
          <p><strong>Name:</strong> ${app.fatherName || ""}</p>
          <p><strong>Office Address:</strong> ${
            app.fatherOfficeAddress || ""
          }</p>
          <p><strong>Residential Address:</strong> ${
            app.fatherResidentialAddress || ""
          }</p>
          <p><strong>Phone:</strong> ${app.fatherPhone || ""}</p>
        </div>
        <div class="mother-info">
          <h6 class="border-top mt-2"><strong>Mother's Details</strong></h6>
          <p><strong>Name:</strong> ${app.motherName || ""}</p>
          <p><strong>Office Address:</strong> ${
            app.motherOfficeAddress || ""
          }</p>
          <p><strong>Residential Address:</strong> ${
            app.motherResidentialAddress || ""
          }</p>
          <p><strong>Phone:</strong> ${app.motherPhone || ""}</p>
        </div>


      </div>
                    </div>


             <div class="row">
                    <hr/>
                        <div class="col-md-8">
 
 
 <h2><strong>Declaration</strong></h2> 
         <div class="section mb-4">
        <p>I, <strong>${app.declarationName || ''}</strong>, the parent of the applicant, 
           hereby declare that all the information provided in this form are accurate and true.</p>
        <p><strong>Parent's Signature:</strong> ${app.parentSignature || ''}</p>
      </div>

     

      </div>
                    </div>
                    
                    


                </div>

                
                </div>
            `;

        const modal = new bootstrap.Modal(
          document.getElementById("applicationModal")
        );
        modal.show();
      };
      window.deleteApplication = async (id) => {
        const result = await Swal.fire({
          title: "Are you sure?",
          text: "Do you want to delete this application? This action cannot be undone.",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#d33",
          cancelButtonColor: "#3085d6",
          confirmButtonText: "Yes, delete it!",
          cancelButtonText: "No, cancel",
        });

        if (result.isConfirmed) {
          try {
            await deleteDoc(doc(db, "applications", id));
            Swal.fire({
              title: "Deleted!",
              text: "The application has been deleted.",
              icon: "success",
            });
            loadApplications(); // Reload the applications list
          } catch (error) {
            console.error("Error deleting application:", error);
            Swal.fire({
              title: "Error!",
              text: "Failed to delete the application.",
              icon: "error",
            });
          }
        } else {
          Swal.fire({
            title: "Cancelled",
            text: "The application was not deleted.",
            icon: "info",
          });
        }
      };

      // Initialize the app
      loadApplications();
    </script>
  </body>
</html>
